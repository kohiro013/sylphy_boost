
#include <stdio.h>

#define TABLESIZE		(256) //2の乗数であること
#define SUBBIT    		(8)
#define SUBINDEX		(1 << SUBBIT)
#define I_PI			(TABLESIZE * SUBINDEX)

const unsigned short napiar_table[] = {
     0,     0,     0,     3,    41,   201,   582,  1244,
  2198,  3419,  4866,  6491,  8250, 10102, 12011, 13950,
 15896, 17831, 19742, 21618, 23451, 25236, 26969, 28647,
 30270, 31835, 33344, 34797, 36194, 37537, 38826, 40065,
 41253, 42393, 43486, 44534, 45538, 46501, 47423, 48306,
 49152, 49962, 50737, 51479, 52189, 52869, 53519, 54141,
 54736, 55305, 55848, 56368, 56864, 57338, 57791, 58223,
 58635, 59028, 59404, 59761, 60102, 60426, 60735, 61029,
 61308, 61574, 61826, 62066, 62293, 62509, 62713, 62907,
 63090, 63262, 63426, 63580, 63725, 63862, 63991, 64112,
 64226, 64333, 64433, 64526, 64614, 64695, 64771, 64841,
 64907, 64968, 65024, 65076, 65124, 65168, 65208, 65245,
 65279, 65309, 65337, 65362, 65385, 65405, 65423, 65440,
 65454, 65467, 65478, 65488, 65496, 65503, 65509, 65515,
 65519, 65523, 65526, 65528, 65530, 65531, 65533, 65533,
 65534, 65534, 65535, 65535, 65535, 65535, 65535, 65535,
 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65534,
 65534, 65533, 65533, 65531, 65530, 65528, 65526, 65523,
 65519, 65515, 65509, 65503, 65496, 65488, 65478, 65467,
 65454, 65440, 65423, 65405, 65385, 65362, 65337, 65309,
 65279, 65245, 65208, 65168, 65124, 65076, 65024, 64968,
 64907, 64841, 64771, 64695, 64614, 64526, 64433, 64333,
 64226, 64112, 63991, 63862, 63725, 63580, 63426, 63262,
 63090, 62907, 62713, 62509, 62293, 62066, 61826, 61574,
 61308, 61029, 60735, 60426, 60102, 59761, 59404, 59028,
 58635, 58223, 57791, 57338, 56864, 56368, 55848, 55305,
 54736, 54141, 53519, 52869, 52189, 51479, 50737, 49962,
 49152, 48306, 47423, 46501, 45538, 44534, 43486, 42393,
 41253, 40065, 38826, 37537, 36194, 34797, 33344, 31835,
 30270, 28647, 26969, 25236, 23451, 21618, 19742, 17831,
 15896, 13950, 12011, 10102,  8250,  6491,  4866,  3419,
  2198,  1244,   582,   201,    41,     3,     0,     0,
     0, 0
};

float mynapier( float ms )
{
	long	ix,	subix,	tval;

	if( ms < 0.0f || 1.0f < ms ) {
		return 0.0f;
	} else {
		ix = (int)(ms * I_PI);			// 単位変換
		subix = ix & (SUBINDEX - 1);	// 線形補完に用いるサブインデックス
		ix >>= SUBBIT;					// テーブル番号に変換

		// 線形補間
		tval = ((long)napiar_table[ix] * (SUBINDEX - subix) + (long)napiar_table[ix+1] * subix);

		return(tval / (SUBINDEX * 65535.f));
	}
}
